<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>neon bonus ¬∑ –ø—Ä—è–º–∞—è –±–∞–∑–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #0a0c12;
            --surface: #14181f;
            --text-primary: #f0f4fa;
            --text-secondary: #9aa8b9;
            --accent: #7c85ff;
            --accent-soft: #2f3545;
            --bonus: #6c8cff;
            --success: #2bbf7c;
            --border-dim: #262e3a;
            --radius-xl: 28px;
            --radius-lg: 22px;
        }
        body {
            background-color: var(--bg);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px 0 24px;
        }
        .app-container {
            width: 100%;
            max-width: 420px;
            background-color: var(--bg);
            padding: 20px 18px 24px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .card {
            background-color: var(--surface);
            border-radius: var(--radius-xl);
            padding: 24px 20px;
            border: 1px solid var(--border-dim);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            background-color: var(--accent-soft);
            color: var(--accent);
            font-weight: 600;
            padding: 14px 22px;
            border-radius: 60px;
            transition: all 0.2s;
            cursor: pointer;
            width: 100%;
            gap: 8px;
        }
        .btn-primary { background-color: var(--accent); color: white; }
        .btn:active { transform: scale(0.97); opacity: 0.7; }
        .btn:disabled { opacity: 0.35; pointer-events: none; }
        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--border-dim);
            border-radius: 12px;
            overflow: hidden;
            margin: 14px 0 8px;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            border-radius: 12px;
            transition: width 0.3s ease;
        }
        .balance-large { font-size: 3rem; font-weight: 500; color: var(--text-primary); }
        .badge {
            background-color: var(--accent-soft);
            padding: 4px 14px;
            border-radius: 40px;
            font-size: 0.85rem;
            color: var(--accent);
        }
        .hint-text { color: var(--text-secondary); font-size: 0.9rem; }
        .flex-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .hidden { display: none !important; }
        @keyframes gentlePop {
            0% { opacity: 0.3; transform: translateY(5px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-balance { animation: gentlePop 0.25s ease-out forwards; }
    </style>
</head>
<body>
    <div id="mainApp" class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="card">
            <div class="flex-row">
                <span class="badge">üí∞ –±–∞–ª–∞–Ω—Å</span>
                <span class="hint-text" id="userId"></span>
            </div>
            <div style="margin-top: 16px;">
                <span class="balance-large" id="balanceDisplay">0</span>
                <span style="font-size: 1.5rem; color: var(--text-secondary);">‚ÇΩ</span>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –±–æ–Ω—É—Å–∞ -->
        <button class="btn" id="bonusBtn" style="background: var(--bonus); color: white; padding: 18px;">
            ‚ú® –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å (1‚Äì100 ‚ÇΩ)
        </button>

        <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
        <div class="card">
            <div class="flex-row" style="margin-bottom: 16px;">
                <span style="font-weight: 600;">üë• —Ä–µ—Ñ–µ—Ä–∞–ª—ã</span>
                <span class="badge" id="referralCount">0/3</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="referralProgress" style="width: 0%;"></div>
            </div>
            <div style="margin-top: 20px;">
                <div class="flex-row" style="margin-bottom: 8px;">
                    <span>—Ç–≤–æ—è —Å—Å—ã–ª–∫–∞</span>
                    <button class="btn" id="copyRefLink" style="padding: 6px 12px; width: auto;">–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="card" style="background: #1e232c; padding: 12px; word-break: break-all;">
                    <span id="refLink" class="hint-text">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
        </div>

        <!-- –í—ã–≤–æ–¥ -->
        <div class="card">
            <div class="flex-row" style="margin-bottom: 16px;">
                <span style="font-weight: 600;">üí∏ –≤—ã–≤–æ–¥</span>
                <span class="badge" id="withdrawStatus">‚õî –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="withdrawProgress" style="width: 0%;"></div>
            </div>
            <div class="flex-row" style="margin: 12px 0;">
                <span class="hint-text">–Ω—É–∂–Ω–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: <span id="referralNeeded">0/3</span></span>
                <span class="hint-text">–±–∞–ª–∞–Ω—Å ‚â•50‚ÇΩ: <span id="balanceCondition">‚ùå</span></span>
            </div>
            <button class="btn" id="withdrawBtn" disabled>üì§ –≤—ã–≤–µ—Å—Ç–∏</button>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="card">
            <span style="font-weight: 600; margin-bottom: 16px; display: block;">üìã –∏—Å—Ç–æ—Ä–∏—è</span>
            <div id="historyList"></div>
        </div>
    </div>

    <script>
        // ==============================================
        // –ù–ê–°–¢–†–û–ô–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö NEON
        // ==============================================
        const NEON_CONFIG = {
    host: 'ep-sparkling-forest-aic1svb9-pooler.c-4.us-east-1.aws.neon.tech',
    database: 'neondb',
    user: 'neondb_owner',
    password: 'npg_GrJdL7gwel2H',
    ssl: true
};

        // –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Neon HTTP API
        async function queryNeon(sql, params = []) {
            const url = `https://${NEON_CONFIG.host}/sql`;
            
            // –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
            const auth = btoa(`${NEON_CONFIG.user}:${NEON_CONFIG.password}`);
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${auth}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: sql,
                        params: params
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`SQL Error: ${error}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Database error:', error);
                throw error;
            }
        }

        // ==============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å 1 —Ä–∞–∑)
        // ==============================================
        async function initDatabase() {
            try {
                // –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await queryNeon(`
                    CREATE TABLE IF NOT EXISTS users (
                        id BIGSERIAL PRIMARY KEY,
                        telegram_id BIGINT UNIQUE NOT NULL,
                        balance INTEGER DEFAULT 0,
                        referral_code VARCHAR(50) UNIQUE,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                    )
                `);

                // –¢–∞–±–ª–∏—Ü–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
                await queryNeon(`
                    CREATE TABLE IF NOT EXISTS referrals (
                        id BIGSERIAL PRIMARY KEY,
                        referrer_id BIGINT NOT NULL,
                        referred_id BIGINT NOT NULL,
                        bonus_received BOOLEAN DEFAULT FALSE,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                    )
                `);

                // –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏
                await queryNeon(`
                    CREATE TABLE IF NOT EXISTS history (
                        id BIGSERIAL PRIMARY KEY,
                        user_id BIGINT NOT NULL,
                        amount INTEGER NOT NULL,
                        type VARCHAR(20) NOT NULL,
                        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                    )
                `);

                console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        // ==============================================
        // –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò
        // ==============================================
        const TELEGRAM_ID = 123456; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ Telegram

        async function loadUserData() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                let user = await queryNeon(
                    'SELECT * FROM users WHERE telegram_id = $1',
                    [TELEGRAM_ID]
                );

                if (user.length === 0) {
                    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const referralCode = `ref_${Math.random().toString(36).substr(2, 9)}`;
                    await queryNeon(
                        'INSERT INTO users (telegram_id, balance, referral_code) VALUES ($1, $2, $3)',
                        [TELEGRAM_ID, 34, referralCode]
                    );
                    user = [{ balance: 34, referral_code: referralCode }];
                }

                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
                const referrals = await queryNeon(
                    'SELECT COUNT(*) as count FROM referrals WHERE referrer_id = $1 AND bonus_received = true',
                    [TELEGRAM_ID]
                );

                // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                const history = await queryNeon(
                    'SELECT * FROM history WHERE user_id = $1 ORDER BY created_at DESC LIMIT 5',
                    [TELEGRAM_ID]
                );

                return {
                    balance: user[0].balance,
                    referralCode: user[0].referral_code,
                    referralsCount: referrals[0]?.count || 0,
                    history: history || []
                };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –±–∞–∑–∞ –µ—â—ë –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
                return {
                    balance: 34,
                    referralCode: 'ref_test123',
                    referralsCount: 1,
                    history: [
                        { type: 'bonus', amount: 15 },
                        { type: 'bonus', amount: 42 }
                    ]
                };
            }
        }

        async function addBonus(userId, amount) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            await queryNeon(
                'UPDATE users SET balance = balance + $1 WHERE telegram_id = $2',
                [amount, userId]
            );
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            await queryNeon(
                'INSERT INTO history (user_id, amount, type) VALUES ($1, $2, $3)',
                [userId, amount, 'bonus']
            );
        }

        // ==============================================
        // –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ==============================================
        let appState = {
            balance: 0,
            referrals: 0,
            referralCode: '',
            history: []
        };

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
        function updateUI() {
            document.getElementById('balanceDisplay').textContent = appState.balance;
            document.getElementById('balanceDisplay').classList.add('animate-balance');
            setTimeout(() => document.getElementById('balanceDisplay').classList.remove('animate-balance'), 250);
            
            const referralPercent = (appState.referrals / 3) * 100;
            document.getElementById('referralProgress').style.width = `${Math.min(referralPercent, 100)}%`;
            document.getElementById('referralCount').textContent = `${appState.referrals}/3`;
            
            document.getElementById('refLink').textContent = `https://t.me/–≤–∞—à_–±–æ—Ç?start=${appState.referralCode}`;
            
            const balanceOk = appState.balance >= 50;
            const referralsOk = appState.referrals >= 3;
            const canWithdraw = balanceOk && referralsOk;
            
            document.getElementById('referralNeeded').textContent = `${appState.referrals}/3`;
            document.getElementById('balanceCondition').textContent = balanceOk ? '‚úÖ' : '‚ùå';
            
            let conditionsMet = 0;
            if (balanceOk) conditionsMet++;
            if (referralsOk) conditionsMet++;
            document.getElementById('withdrawProgress').style.width = `${(conditionsMet / 2) * 100}%`;
            
            const withdrawBtn = document.getElementById('withdrawBtn');
            if (canWithdraw) {
                withdrawBtn.disabled = false;
                withdrawBtn.style.background = 'var(--success)';
                document.getElementById('withdrawStatus').textContent = '‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω';
            } else {
                withdrawBtn.disabled = true;
                withdrawBtn.style.background = 'var(--accent-soft)';
                document.getElementById('withdrawStatus').textContent = '‚õî –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            }
            
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            if (appState.history.length === 0) {
                historyList.innerHTML = '<div class="hint-text">–ø–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>';
            } else {
                appState.history.slice(0, 5).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.style.padding = '12px';
                    div.style.marginBottom = '8px';
                    div.style.display = 'flex';
                    div.style.justifyContent = 'space-between';
                    
                    if (item.type === 'bonus') {
                        div.innerHTML = `<span class="hint-text">‚ûï –±–æ–Ω—É—Å</span>
                                        <span style="color: var(--success);">+${item.amount} ‚ÇΩ</span>`;
                    } else {
                        div.innerHTML = `<span class="hint-text">üì§ –≤—ã–≤–æ–¥</span>
                                        <span style="color: var(--text-secondary);">-${item.amount} ‚ÇΩ</span>`;
                    }
                    historyList.appendChild(div);
                });
            }
        }

        // ==============================================
        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
        // ==============================================
        document.getElementById('bonusBtn').addEventListener('click', async () => {
            const bonusAmount = Math.floor(Math.random() * 100) + 1;
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
                await addBonus(TELEGRAM_ID, bonusAmount);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                appState.balance += bonusAmount;
                appState.history.unshift({ type: 'bonus', amount: bonusAmount });
                if (appState.history.length > 5) appState.history.pop();
                
                updateUI();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                // –ï—Å–ª–∏ –±–∞–∑–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Å—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ–º
                appState.balance += bonusAmount;
                appState.history.unshift({ type: 'bonus', amount: bonusAmount });
                updateUI();
            }
        });

        document.getElementById('withdrawBtn').addEventListener('click', async () => {
            if (appState.balance >= 50 && appState.referrals >= 3) {
                try {
                    await queryNeon(
                        'UPDATE users SET balance = 0 WHERE telegram_id = $1',
                        [TELEGRAM_ID]
                    );
                    await queryNeon(
                        'INSERT INTO history (user_id, amount, type) VALUES ($1, $2, $3)',
                        [TELEGRAM_ID, appState.balance, 'withdraw']
                    );
                    
                    appState.history.unshift({ type: 'withdraw', amount: appState.balance });
                    appState.balance = 0;
                    updateUI();
                    alert('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                }
            }
        });

        document.getElementById('copyRefLink').addEventListener('click', () => {
            navigator.clipboard.writeText(document.getElementById('refLink').textContent);
            alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
        });

        // –î–ª—è —Ç–µ—Å—Ç–∞: –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ —Å—á—ë—Ç—á–∏–∫–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
        document.getElementById('referralCount').addEventListener('dblclick', () => {
            if (appState.referrals < 3) {
                appState.referrals++;
                updateUI();
            }
        });

        // ==============================================
        // –ó–ê–ü–£–°–ö
        // ==============================================
        (async function init() {
            // –°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É
            await initDatabase();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userData = await loadUserData();
            appState = {
                balance: userData.balance,
                referrals: userData.referralsCount,
                referralCode: userData.referralCode,
                history: userData.history
            };
            
            updateUI();
        })();
    </script>
</body>
</html>
