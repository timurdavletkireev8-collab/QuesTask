<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captcha Bot</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 400px; margin: 0 auto; text-align: center; }
        input, button { padding: 10px; margin: 5px; width: 90%; border-radius: 5px; }
        button { background: #0088cc; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Captcha Bot</h1>
        <div id="balance">üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balanceValue">0</span></div>
        <div id="task" style="margin:20px; padding:20px; background:#333; border-radius:10px;">
            –ù–∞–∂–º–∏ "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ"
        </div>
        <input type="text" id="answer" placeholder="–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç">
        <button onclick="submitAnswer()">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="getTask()">üîÑ –ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</button>
        <div id="message"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBxFHQgZP2UROSY5eNk7j6O-WdGjLTRL6U",
            authDomain: "captcha-bot-123.firebaseapp.com",
            projectId: "captcha-bot-123",
            storageBucket: "captcha-bot-123.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const userId = tg.initDataUnsafe?.user?.id || 'anonymous';
        let currentCaptchaId = null;

        async function loadBalance() {
            const userRef = doc(db, "users", String(userId));
            const userSnap = await getDoc(userRef);
            
            if (userSnap.exists()) {
                document.getElementById('balanceValue').textContent = userSnap.data().balance || 0;
            } else {
                await setDoc(userRef, { balance: 0, createdAt: new Date().toISOString() });
                document.getElementById('balanceValue').textContent = '0';
            }
        }

        window.getTask = async function() {
            document.getElementById('message').innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∂–∞—é...';
            
            const response = await fetch('https://your-vercel-app.vercel.app/api/get-captcha');
            const data = await response.json();
            
            if (data.success) {
                currentCaptchaId = data.captchaId;
                document.getElementById('task').innerHTML = 'üî¢ –†–µ—à–∏ –∫–∞–ø—á—É: [–ö–ê–†–¢–ò–ù–ö–ê –¢–£–¢]';
                document.getElementById('message').innerHTML = '‚úÖ –ó–∞–¥–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!';
            } else {
                document.getElementById('message').innerHTML = '‚ùå ' + data.error;
            }
        }

        window.submitAnswer = async function() {
            const answer = document.getElementById('answer').value;
            if (!answer || !currentCaptchaId) return alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏ –∑–∞–¥–∞–Ω–∏–µ!');
            
            document.getElementById('message').innerHTML = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é...';
            
            const response = await fetch('https://your-vercel-app.vercel.app/api/submit-answer', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    captchaId: currentCaptchaId,
                    answer: answer,
                    userId: userId
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                const userRef = doc(db, "users", String(userId));
                await updateDoc(userRef, { balance: increment(1) });
                
                const balanceEl = document.getElementById('balanceValue');
                balanceEl.textContent = parseInt(balanceEl.textContent) + 1;
                
                document.getElementById('message').innerHTML = '‚úÖ –í–µ—Ä–Ω–æ! +1 –º–æ–Ω–µ—Ç–∞';
                document.getElementById('task').innerHTML = 'üéâ –ú–æ–ª–æ–¥–µ—Ü! –ñ–º–∏ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ';
                document.getElementById('answer').value = '';
                currentCaptchaId = null;
            } else {
                document.getElementById('message').innerHTML = '‚ùå ' + data.error;
            }
        }

        loadBalance();
    </script>
</body>
</html>
